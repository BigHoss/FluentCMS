@using FluentCMS.Entities
@using System.Linq
<h2>
    Section: @Name, Page: @AppState?.Page?.Title
</h2>
@if (AppState?.Page?.Plugins != null)
{
    @foreach (var plugin in AppState.Page.Plugins.Where(x => x.Section.ToLower() == Name.ToLower()).OrderBy(x => x.Order))
    {
        <CascadingValue Value="@plugin" Name="Plugin">
            <DynamicComponent Type=@GetType(plugin) />
        </CascadingValue>
    }
}
@code {
    [Parameter]
    public string Name { get; set; } = string.Empty;

    [CascadingParameter]
    public AppState? AppState { get; set; }

    private Type? GetType(PluginResponse plugin)
    {
        var assembly = typeof(Section).Assembly;
        var typeInfo = assembly.DefinedTypes.FirstOrDefault(x => x.Name == plugin.Definition.ViewType);
        return typeInfo?.AsType();
    }
    protected override Task OnInitializedAsync()
    {
        return base.OnInitializedAsync();
    }

    protected override Task OnParametersSetAsync()
    {
        return base.OnParametersSetAsync();
    }

    protected override Task OnAfterRenderAsync(bool firstRender)
    {
        return base.OnAfterRenderAsync(firstRender);
    }

    protected override bool ShouldRender()
    {
        return base.ShouldRender();
    }
}
